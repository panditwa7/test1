---
- name: Load variable file
  include_vars: ../ENV_INFO/emm.yml

- name: Create directory '{{ upgrade_dir }}'
  file:
    path: '{{ upgrade_dir }}'
    state: directory
    mode: '0777'

#- name: change permissions to upgrade_dir directory
#  file:
#    path: '{{ upgrade_dir }}'
#    owner: "{{user}}"
#    group: "{{user}}"
#    mode: '0755'

#- name: Copy SW - Redhat
#  copy:
#    src: "{{ emm_media_src_dir }}/{{ redhat_sw }}"
#    dest: "{{ upgrade_dir }}"
#    force: no

- name: Copy SW - Infoscale
  copy:
    src: "{{ emm_media_src_dir }}/{{ infoscale_sw }}"
    dest: "{{ upgrade_dir }}"
    force: no

- name: Copy SW - 3PPs
  copy:
    src: "{{ emm_media_src_dir }}/{{ threepp_sw }}"
    dest: "{{ upgrade_dir }}"
    force: no
  
- name: Copy SW - tools
  copy:
    src: "{{ emm_media_src_dir }}/{{ tool_sw }}"
    dest: "{{ upgrade_dir }}"
    force: no


- name: Copy SW - application
  copy:
    src: "{{ emm_media_src_dir }}/{{ appl_sw }}"
    dest: "{{ upgrade_dir }}"
    force: no

- name: Uncompress SW
  shell: unzip -o {{ redhat_sw }}; unzip -o {{ infoscale_sw }};  unzip -o {{ tool_sw }}; unzip -o {{ threepp_sw }}; unzip -o {{ appl_sw }}; tar -xvf *.tar
  args:
    chdir: '{{ upgrade_dir }}'


- name: Find zip and tar files
  find:
    paths: "{{ upgrade_dir }}"      
    patterns: "*.zip,*.tar"
  register: find_result

- name: Delete all zip and tar files
  file: 
    path: "{{ item.path }}"
    state: absent
  with_items: "{{ find_result.files }}"

- name: Give permissions to working directory
  file: 
    path: "{{ upgrade_dir }}"
    state: directory
    mode: '0777'
    recurse: yes
  #become: yes
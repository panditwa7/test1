---
  # tasks file
  - name: Load enviroment file
    include_vars: ../ENV_INFO/emm.yml
  - name: Get EM20 Installation Tool version
    shell: ls -td {{ working_dir }}/CXP* | head -1
    register: version
  - name: Cleanup CMP directory if already exists
    file:
      path: "{{ version.stdout }}/CMP"
      state: absent
  - name: Copy Additional Components configuration
    copy: src="../ENV_INFO/CMP" dest={{ version.stdout }}/
  - name: Get .in files
    shell: ls {{ version.stdout }}/CMP/*.in
    register: in_file
  - name: Create additional Logical Servers - check logs in /var/adm/MM_LOGS - or connect with "screen -x DEVOPS" in master node
    shell: screen -x DEVOPS "cat {{ item }} | sudo -E {{ version.stdout }}/MM_UTILITY"    
  - name: Create additional Components - check logs in /var/adm/MM_LOGS    
    environment:
      ACTIVITY_TYPE: '{{ ACTIVITY_TYPE }}'
